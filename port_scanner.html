<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<title>localhost port scanner</title>
	</head>
	<body>
<h2>Port scanning test</h2>
		<div>
			A simple browser-based port scan of your local computer, to see what ports are exposed to websites. This <b>can not</b> tell what is on those ports or if it can be exploited.
</div>
<button id="start">Start test</button><br>
		<p><label>Enter the highest port to scan (i.e. 8080): <input type="number" id="max" placeholder="The highest port to scan..." value="200"></label><br>
<div id="log">
</div>
<script>
	var log = function(m,ok){
		var e = document.createElement("span")
		e.innerText = m
		if(ok === true){
			e.style.color = "green"
		}
		else{
			e.style.color = "red"
		}
		document.getElementById("log").appendChild(e)
		document.getElementById("log").appendChild(document.createElement("br"))
	}
	
	var test = async function(port){
		var det = false
		try{
			await fetch("http://localhost:" + port,{mode:"no-cors"})
			window.detectedon.push(port)
			console.log("Detected on port " + port, false)
			det = true
		}
		catch(err){
			console.log("Not detected on port " + port,true)
			det = false
		}
		window.total[port] = det
		window.total.length += 1
		if(window.total.length >= 90 & window.resp == false){
			var e = Object.entries(window.total)
			window.resp = true
			for(var times = 0;times < e.length;times++){
				if(e[times][0] == "length"){
					continue
				}
				if(e[times][1] == true){
					log("Detected on " + e[times][0],false)
				}
				else{
					log("Not detected on " + e[times][0],true)
				}
			}
		}
	}
	
	function getMaxNumber(){
		try{
			return new Number(document.getElementById("max").value)
		}
		catch(err){ /*if it isn't a valid number, return the default value*/
		return 200
		}
	}
	
	document.getElementById("start").onclick = async function(){
		window.detectedon = []
		window.total = {}
		window.total.length = 0
		window.resp = false
		window.p = 0;
		for(window.p = 0; window.p <= getMaxNumber(); window.p ++){
			try{
				test(p)
			}
			catch(err){
				console.log("Error in running test: ",err)
			}
	
		}
	}
</script>
</body>
</html>

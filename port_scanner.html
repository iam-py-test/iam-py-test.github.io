<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>localhost Port scanning test</title>
  </head>
  <body>
<h2>Port scanning test</h2>
<button id="start">Start test</button><br>
<div id="log">
</div>
<script>
  var log = function(m,ok){
    var e = document.createElement("span")
    e.innerText = m
    if(ok === true){
      e.style.color = "green"
    }
    else{
      e.style.color = "red"
    }
    document.getElementById("log").appendChild(e)
    document.getElementById("log").appendChild(document.createElement("br"))
  }
  
  var test = async function(port){
    var det = false
    try{
      await fetch("http://localhost:" + port,{mode:"no-cors"})
      window.detectedon.push(port)
      console.log("Detected on port " + port, false)
      det = true
    }
    catch(err){
      console.log("Not detected on port " + port,true)
      det = false
    }
    window.total[port] = det
    window.total.length += 1
    if(window.total.length >= 90){
      var  = Object.entries(window.total)
      for(var times = 0;times < e.length;times++){
        if(e[times][0] == "length"){
          continue
        }
        if(e[times][1] == true){
          log("Detected on " + e[times][0],false)
        }
        else{
          log("Not detected on " + e[times][0],true)
        }
      }
    }
  }
  
  document.getElementById("start").onclick = async function(){
    window.detectedon = []
    window.total = {}
    window.total.length = 0
    window.p = 0;
    for(window.p = 0; window.p <= 90; window.p ++){
      try{
        test(p)
      }
      catch(err){
        console.log("Error in running test: ",err)
      }
  
    }
  }
</script>
  </body>
</html>
